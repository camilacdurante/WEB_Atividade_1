<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
  <title>Tragic Draw</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd"></script>
</head>

<body>
  <h2>Tragic Draw</h2>
  <h3>FaÃ§a um desenho e eu tentarei adivinhar!</h3>
  <canvas id="canvas" width="400" height="400"></canvas>

  <div id="controles">
    <label>Cor:
      <input type="color" id="cor" value="#000000">
    </label>
    <label>Espessura:
      <input type="range" id="espessura" min="1" max="30" value="5">
    </label>
    <button onclick="modo = 'lapis'">âœï¸ LÃ¡pis</button>
    <button onclick="modo = 'borracha'">ğŸ§½ Borracha</button>
    <button onclick="limpar()">ğŸ«§ Limpar</button>
    <button onclick="adivinhar()">ğŸ§  Adivinhar</button>
  </div>
  <div id="results" class="result"></div>

  <script>
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    let desenhando = false;
    let modo = "lapis"; // ou "borracha"

    canvas.addEventListener("mousedown", () => desenhando = true);
    canvas.addEventListener("mouseup", () => desenhando = false);
    canvas.addEventListener("mouseout", () => desenhando = false);

    canvas.addEventListener("mousemove", desenhar);

    function desenhar(e) {
      if (!desenhando) return;

      const cor = document.getElementById("cor").value;
      const espessura = document.getElementById("espessura").value;
      const rect = canvas.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;

      ctx.beginPath();
      ctx.arc(x, y, espessura / 2, 0, Math.PI * 2);
      ctx.fillStyle = modo === "borracha" ? "#fff" : cor;
      ctx.fill();
    }

    function limpar() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
    }

    let cocoModel;

    cocoSsd.load().then(m => {
      cocoModel = m;
      console.log('Object detection model loaded.');
    });

    function adivinhar() {
      const canvas = document.getElementById("canvas");
      const ctx = canvas.getContext("2d");
      const resultDiv = document.getElementById("results");
      resultDiv.innerHTML = 'Deixa eu pensar...';
      //const predictions = cocoModel.detect(canvas); // passa canvas direto

      cocoModel.detect(canvas).then(predictions => {
            console.log('Predictions:', predictions);
            drawBoxes(predictions, ctx);
            displayResults(predictions);
          });


    }



    function drawBoxes(predictions, ctx) {
      ctx.lineWidth = 2;
      ctx.font = '16px Arial';
      predictions.forEach(p => {
        ctx.strokeStyle = '#00FF00';
        ctx.fillStyle = '#00FF00';
        const [x, y, width, height] = p.bbox;
        ctx.strokeRect(x, y, width, height);
        ctx.fillText(`${p.class} (${(p.score * 100).toFixed(1)}%)`, x, y > 10 ? y - 5 : y + 15);
      });
    }

    function displayResults(predictions) {
      const resultDiv = document.getElementById('results');
      if (predictions.length === 0) {
        resultDiv.innerHTML = '<p>No objects detected.</p>';
        return;
      }

      resultDiv.innerHTML = '<ul>' + predictions.map(p =>
        `<li>${p.class}: ${(p.score * 100).toFixed(1)}%</li>`
      ).join('') + '</ul>';
    }
  </script>
</body>
</html>
